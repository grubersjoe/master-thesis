\chapter{Schlussbetrachtung}
\label{chap:conclusion}

\enlargethispage{\baselineskip}
\section{Zusammenfassung der Ergebnisse}

In der vorliegenden Masterarbeit wurde die Fragestellung behandelt, wie das statische Typsystem Flow~\autocite{FLOW:PAPER} nach TypeScript~\autocite{TYPESCRIPT:SPEC} übersetzt werden kann, um eine derartige Migration von JavaScript-Quelltexten zu automatisieren. Hierfür wurde ein Transpiler auf Grundlage von Babel entwickelt, mit dessen Hilfe zwei Projekte des Unternehmens Spreadshirt erfolgreich nach TypeScript übertragen wurden.

Mit dem Wechsel des statischen Typsystems wurden verschiedene Ziele verfolgt:
So sollten Typ- und Programmfehler im bestehenden Programmcode aufgedeckt und die Erkennung von weiteren Typverletzungen in Zukunft vereinfacht werden. Nach der Migration wurden in beiden Projekten zahlreiche Typfehler durch TypeScript erkannt. Der Großteil dieser neu aufgetretenen Fehler kann auf die ausgeführten grundlegenden Unterschiede von Flow und TypeScript, die Integration externer Typdeklarationen für Bibliotheken und auf Unzulänglichkeiten der vorherigen Flow-Typisierung zurückgeführt werden. Durch einen kleinen Teil der Typverletzungen wurden aber tatsächlich bisher unerkannte unkritische Programmfehler offen gelegt.
Weiterhin wurde durch die Migration angestrebt, die Unterstützung für externe Software-Bibliotheken durch das Typsystem zu verbessern. Diese Zielsetzung wurde erreicht: Wie gezeigt bestehen bei TypeScript Typdefinitionen für etwa zehn mal mehr Bibliotheken als bei Flow. Jedoch konnten bei der konkreten Betrachtung einer Auswahl der meistverwendesten Pakete in den zwei Projekten von Spreadshirt nur geringfügige Vorteile bei TypeScript hinsichlicht der Aktualität und der Qualität der Typdeklarationen festgestellt werden.
Das dritte Ziel, die Steigerung der Performance der Typüberprüfungen, wurde nur teilweise erreicht. Nur in Einzelfällen konnte im Projekt Helios bei TypeScript eine geringere Laufzeit der vollständigen Berechnungen der Typkorrektheit gegenüber Flow gemessen werden. Aufgrund von technischen Einschränkungen, welche die Messung verfälscht hätten, konnte die Dauer von inkrementellen Typüberprüfungen in dieser Arbeit nicht untersucht werden. Grundsätzlich scheint die stark parallelisierte Architektur von Flow der von TypeScript bezüglich der Performance überlegen.
Zuletzt wurden durch den Wechsel zu TypeScript Vorteile hinsichtlich der Zukunftssicherheit der Technologie erwartet. In der Tat wird TypeScript im Vergleich zu Flow offener entwickelt, gemeldete Programmfehler werden im Allgemeinen schneller bearbeitet und die Kommunikation ist weitaus transparenter. Da bei TypeScript regelmäßig detaillierte Projektpläne veröffentlicht werden, besteht hier eine insgesamt größere Zukunftssicherheit bezüglich der Weiterentwicklung des Systems.

Neben diesen Zielen der Migration wurden darüber hinaus technische Anforderungen an den Transpiler definiert: Dieser soll in der Lage sein, jegliche Flow-Syntax korrekt in äquivalente TypeScript-Ausdrücke zu übersetzen. Die Äquivalenz der Transformationen wurde größtenteils umgesetzt, jedoch existieren wie beschrieben einerseits Typen, die prinzipiell nicht bedeutungsgleich nach TypeScript überführt werden können, andererseits konnte für drei Hilfstypen von Flow kein äquivalenter TypeScript-Ausdruck gefunden werden. Die Erzielung sowohl der Vollständigkeit als auch der Korrektheit der Übersetzungen wurde durch Fixture-Tests überprüft.
Weiterhin wurde vorgegeben, dass die Ausführung des Transpilers die Semantik des Eingabeprogramms nicht verändern darf, damit keine neuen Programmfehler in die Ausgabe eingeführt werden. Mit Hilfe der bestehenden Modultests der zwei Projekte wurde näherungsweise gezeigt, dass der Transcompiler die Semantik des Programms tatsächlich nur wo nötig verändert.
Auf Grundlage der Rahmenbedingungen innerhalb des Unternehmens wurde außerdem spezifiziert, dass der Transpiler aktuelle JavaScript-Syntax gemäß des ECMAScript-Standards 2019~\autocite{ECMASCRIPT:2019}, bestimmte vorläufige Spracherweiterungen wie zum Beispiel Klassendekoratoren und JSX-Syntax unterstützen muss. Durch den Einsatz von Babel und verschiedener vorgegebener Plugins wurde diese Anforderung vollständig erreicht.
Zuletzt muss der Transpiler zum einen gesamte Projektverzeichnisse verarbeiten können, zum anderen eine originalgetreue Formatierung der Ausgabe ermöglichen. Beide Vorgaben wurden durch die Umsetzung eines Kommandozeilenprogramms, das die geforderte Funktionen implementiert, erfüllt. Allerdings konnte gezeigt werden, dass die Formatierung bei den zwei migrierten Projekten für 4,7\% der Dateien fehlgeschlagen ist.

Zur Einordnung der Ergebnisse wurden die vergleichbaren Ansätze von Kikura~\autocite{KIKURA:FLOW_TO_TS} und Barabash~\autocite{BARABASH:FLOW_TO_TS} zur Transpilierung von Flow herangezogen. Dabei konnte nachgewiesen werden, dass bei Kikura und Barabash 54,8\% bzw. 9,7\% der Fixture-Dateien zur Erprobung der korrekten Übersetzung aufgrund von Laufzeitfehlern überhaupt nicht verarbeiten werden können und in 1,9\% bzw. 11,0\% der anderen Testfälle nicht äquivalente Transformationen auftreten. Weiterhin wurde aufgezeigt, dass beide Ansätze auch bei bestimmter valider Flow-Syntax infolge von Programmfehlern abstürzen. Barabash ermöglicht wie der umgesetzte Transpiler die Verarbeitung ganzer Projektverzeichnisse. Allerdings wurden hier schlechtere Ergebnisse hinsichtlich der Formatierung der Ausgabe festgestellt (4,7\% bzw. 7,0\% Fehlerrate).

Zusammenfassend kann die Migration zu TypeScript bei Spreadshirt als erfolgreich betrachtet werden: Wie ausgeführt wurden einerseits die gesetzten Ziele größtenteils erreicht, andererseits die technischen Anforderungen an den Transpiler mehrheitlich erfüllt. Durch den Übersetzer konnte der Arbeitsaufwand und die Fehleranfälligkeit des Wechsels des Typsystems deutlich reduziert werden. Die auf diese Weise migrierten Projekte Components und Helios wurden inzwischen in einer neuen Version ausgeliefert und sind produktiv im Einsatz. Auch das Entwicklerteam von TeamShirts ist laut eigener Aussage sehr zufrieden mit dem vollzogenen Wechsel zu TypeScript.

% \vspace*{-0.25\baselineskip}
\section{Erweiterung der Migration}

Zuletzt soll auf zwei Aspekte dieser Arbeit eingegangen werden, die zukünftig optimiert werden könnten: So treten bei der originalgetreuen Formatierung der Ausgabe durch den Transpiler wie gezeigt noch teilweise Fehler auf. Das implementierte zeilenbasierte Verfahren funktioniert zwar in den allermeisten Fällen akkurat, ist aber nicht besonders robust. Sobald eine Abweichung beim Vergleich der Ein- und Ausgabe auftritt, ist eine korrekte Behandlung der verbleibenden Datei unmöglich\footnote{Vgl. Abschnitt~\ref{sec:results-formatting}.}. Ein aussichtsreicher Ansatz wäre, die gesamte Quelltext-Transformation durch einen konkreten statt abstrakten Syntaxbaum umzusetzen, damit die Information über die Formatierung des ursprünglichen Quelltexts präzise beibehalten wird. Bereits während der Entwicklung des Transpilers wurde dieser Ansatz in Betracht gezogen und nach geeigneten Bibliotheken gesucht. Dabei wurde das Projekt \textit{CST} (\textit{Concrete Syntax Tree})~\autocite{SOFTWARE:CST} gefunden, welches das Einlesen konkreter Syntaxbäume für JavaScript ermöglicht. Allerdings werden hierbei weder Flow, noch TypeScript unterstützt, sodass die angestrebte Verwendung so nicht möglich ist. Falls das Projekt aber entsprechend erweitert werden würde, könnte die Programmtransformation perspektivisch auf diese Weise durchgeführt werden.

Aufgrund des begrenzten zeitlichen Rahmens dieser Masterarbeit konnten in den zwei migrierten Projekten von TeamShirts nur die nicht-strikte Überprüfung von Typfehlern durch TypeScript realisiert werden. Zur weiteren Steigerung der statischen Typsicherheit sollte deshalb zukünftig in beiden Projekten strikte Überprüfungen aktiviert und die resultierenden Typfehler daraufhin korrigiert werden.
